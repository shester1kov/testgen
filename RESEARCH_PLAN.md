# План исследовательской реализации Test Generation System

## 1. Основная идея проекта

- **Что разрабатываем**: веб‑платформу, которая автоматически генерирует тестовые вопросы из учебных материалов (PDF, DOCX, PPTX, TXT) с помощью LLM и экспортирует их в Moodle.
- **Проблема**: ручная подготовка тестов занимает время, повышает риск ошибок и не масштабируется при большом количестве дисциплин.
- **Целевая аудитория**: преподаватели и методисты вузов/колледжей, администраторы LMS, ассистенты курсов.
- **Роли и задачи**:
  - *Admin*: управление пользователями и ролями, контроль аудит‑логов, конфигурация интеграций.
  - *Teacher*: загрузка материалов, генерация/редактирование тестов, экспорт в Moodle, просмотр метрик качества вопросов.
  - *Student* (на перспективу): прохождение сгенерированных тестов для валидации качества.

## 2. Анализ требований

- **Ожидания пользователей**:
  - Быстрая генерация корректных вопросов из разнородных форматов файлов.
  - Ручная доработка вопросов перед экспортом (UI для правок и валидаций).
  - Надёжная интеграция с Moodle (XML импорт, настройка банков вопросов).
  - Прозрачная оценка качества: предпросмотр, метрики сложности, истории генераций.
- **Ключевые функции**:
  - Импорт документов, извлечение текста и метаданных.
  - Запуск LLM‑пайплайна с параметрами (количество вопросов, типы, уровень сложности).
  - Редактор вопросов (варианты ответов, корректность, пояснения, теги/темы).
  - Экспорт в Moodle XML и журналирование выгрузок.
  - RBAC аутентификация/авторизация, аудит действий, трекинг версий тестов.
  - Мониторинг и алертинг (Prometheus/Grafana), просмотр логов (Loki/Promtail).

## 3. Архитектура

- **Компоненты**:
  - Frontend (Vue SPA) — UI для загрузки материалов, редактора вопросов, просмотра метрик.
  - Backend (Go + Fiber) — REST API, оркестрация LLM‑пайплайна, валидация, RBAC, экспорт в Moodle XML.
  - PostgreSQL — хранение пользователей, ролей, тестов, историй генераций и экспортов.
  - Redis — кэш промежуточных шагов и сессий экспорта.
  - LLM API (Perplexity/OpenAI/YandexGPT) — генерация вопросов из текста.
  - Nginx — балансировка и терминация TLS.
  - Observability стек — Prometheus, Grafana, Loki/Promtail для метрик и логов.
- **Взаимодействие**:
  - SPA общается с backend по HTTPS (Nginx проксирует). Backend обращается к PostgreSQL/Redis, вызывает LLM API, сохраняет версии вопросов и формирует XML для Moodle. Метрики пушатся в Prometheus; логи собирает Promtail → Loki → Grafana.

## 4. Технологический стек

- **Языки/фреймворки**: Go 1.23 + Fiber v2, Vue 3 + TypeScript + Vite, Tailwind 4, Pinia, Vue Router.
- **БД/кэш**: PostgreSQL 15, Redis 7, GORM ORM, golang-migrate для миграций.
- **Инфраструктура**: Docker Compose, Nginx, Wire (DI), Axios (HTTP), Swagger/OpenAPI для спецификации API.
- **AI/ML**: адаптеры под Perplexity API / OpenAI API / YandexGPT с конфигурируемыми параметрами.

## 5. Безопасность

- JWT в HTTP‑only cookie + Authorization header; проверка ролей middleware.
- Bcrypt‑хеширование паролей, обязательный HTTPS (TLS), строгая конфигурация CORS.
- Валидация входных данных на всех слоях; подготовленные выражения в GORM против SQL‑инъекций.
- Заголовки безопасности (CSP, HSTS), защита от XSS/CSRF через cookie‑флаги и anti‑CSRF токены для mutating запросов.
- Секреты и ключи LLM в переменных окружения/Secrets Manager; ротация ключей.
- Аудит‑логирование действий администраторов и операций экспорта; лимитирование запросов для API.

## 6. План разработки и управление

- **Фазы (Waterfall)**:
  1. Сбор требований и согласование сценариев (1–2 недели).
  2. Проектирование архитектуры, схем БД, контрактов API (1 неделя).
  3. Реализация backend (аутентификация, загрузка файлов, LLM‑пайплайн, экспорт) (3–4 недели).
  4. Реализация frontend (auth, загрузка, редактор, предпросмотр, экспорт) (3–4 недели, параллельно с фазой 3 после стабилизации API).
  5. Интеграционное тестирование, hardening безопасности, оптимизация (2 недели).
  6. Документация, обучение пользователей, релиз и пост‑релизная поддержка (1 неделя).
- **Ресурсы**: 2 backend инженера, 2 frontend инженера, DevOps, QA, UX/UI дизайнер.
- **Управление**: каскад с контрольными точками; ведение требований в backlog, фиксированные артефакты (SRS, архитектурные схемы, тест‑план), change‑management через RFC.

## 7. Макеты и прототипы

- Набор low‑fi wireframes: экран загрузки файла → очередь генерации → список версий тестов → экран редактора (вопрос, варианты, теги) → экспорт в Moodle.
- UX‑паттерны: мастер‑шаги для генерации, правки в боковой панели, превью XML перед выгрузкой, статус‑бар прогресса, уведомления об ошибках LLM.
- Гайдлайны: адаптация под ГОСТ Р ИСО 9241 (контрастность, масштабируемость шрифта, клавиатурная навигация), responsive макет под 1280+ px.

## 8. Стратегия тестирования

- **Типы тестов**: модульные (Go/Vue), контрактные API (Swagger + Postman/newman), интеграционные (LLM мок/песочница), e2e (Cypress/Playwright), перформанс (k6), безопасность (SAST, dependency scan, fuzzing для парсинга файлов), юзабилити‑сессии.
- **Критерии успеха**: покрытие критических модулей ≥80%, успешный импорт/экспорт XML, время генерации <30 с на документ, отсутствие критичных уязвимостей по SAST, положительная оценка UX‑тестов.

## 9. Документация

- SRS с use‑cases и бизнес‑правилами; архитектурные решения (ADR), ERD и UML (Use Case, Sequence, Activity, Class).
- API документация (Swagger), гайды по развёртыванию (Docker/локально), гайды по безопасной эксплуатации.
- Руководство пользователя: загрузка материалов, настройка параметров LLM, правки вопросов, экспорт в Moodle.
- Dev/ops инструкции: миграции БД, observability, политика логирования.

## 10. Итоги и перспективы

- **Полученные знания**: специфика работы LLM с образовательными материалами, требования Moodle к XML, интеграция observability стека и RBAC в распределённом монолите.
- **Возможные улучшения**: адаптивная подборка типов вопросов на основе аналитики, тонкая настройка подсказок LLM, автоподсветка некорректных вопросов по метрикам, офлайн‑режим генерации с локальной моделью, A/B‑тестирование промптов.
